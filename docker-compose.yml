version: "3.9"

services:
  api:
    build: ./apps/api
    ports:
      - "3001:3001"
    environment:
      - WEB_BASE_URLS=http://localhost:5173,http://web:5173
      - MODE=mock
      - SLOW_START_MS=1200

  web:
    build: ./apps/web
    ports:
      - "5173:5173"
    environment:
      - VITE_API_BASE_URL=http://api:3001
      - VITE_MODE=mock
    depends_on:
      - api

  tests:
    image: mcr.microsoft.com/playwright:v1.47.0-jammy
    working_dir: /work
    depends_on:
      - api
      - web
    volumes:
      - ./:/work
    command: ["bash", "-lc", "npm install && npx playwright install --with-deps && npm run test:smoke"]
